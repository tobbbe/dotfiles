# NOTE: reload config (not all work) with c-s-f5
#
# include theme first so we can override it
# theme Catppuccin-Mocha
include current-theme.conf

# font_family "SFMono Nerd Font"
# font_family      family="IBM Plex Mono"
# font_family      family="Fragment Mono"
font_family      family="0xProto NL"
bold_font        auto
italic_font      auto
bold_italic_font auto
font_size 17

# modify_font cell_height 6px

# if not working, check so that theme is not overriding (ex current-theme.conf)
# macos_titlebar_color #0F0F19
hide_window_decorations titlebar-only

# top, right, bottom, left
window_padding_width 0 0 0 0
window_margin_width 0 0 0
# single_window_margin_width 8.0 0 0 # if hiding tabs < 1
single_window_margin_width 0 0 0

placement_strategy top
tab_bar_margin_height 6.0 0
tab_bar_margin_width 10.0

# background_opacity 0.73
# background_blur 2
start_as_hidden no
cursor_shape block
cursor_blink_interval 0
shell_integration no-cursor
confirm_os_window_close 0

# Enable remote control for nvim integration
allow_remote_control yes
listen_on unix:/tmp/kitty-socket

# cursor_trail 3
# cursor_trail_decay 0.1 0.3
# cursor_trail_start_threshold 2

tab_bar_filter session:~ or session:^$
tab_bar_edge                top
tab_bar_align center
tab_bar_style               separator
tab_separator " "
tab_powerline_style         slanted
tab_title_template          {title if tab.active_exe == 'nvim' else tab.active_exe.lstrip('-')}{' :{}:'.format(num_windows) if num_windows > 100 else ''}
tab_bar_min_tabs 1
# tab_bar_style hidden

# keymaps
macos_option_as_alt left

# ðŸš¨ ctrl+shift is intercepted by default by Kitty (kitty_mod). Override specific here

map ctrl+c copy_or_noop
map ctrl+v cmd+v

# c-s-f to search everywhere in nvim
map ctrl+shift+f send_text all \x1b[102;6u

# Code mode remaps (controlled by Karabiner F3 toggle)
map Ã¥ send_text all [
map Ã… send_text all {
map f13 send_text all ]
map f19 send_text all }

# shift enter for newline in claude etc
# map shift+enter send_text all \x1b\r
# USE THIS INSTEAD. Works in all terminals without configuration:
# 1. Backslash + Enter (\ + Enter) - Quick escape method
# 2. Ctrl+J - Control sequence for line feed
# 3. Option+Enter - Default on macOS

# enable Shift+Enter detection via Kitty keyboard protocol
map shift+enter send_text all \x1b[13;2u
# send ctrl+tab to apps (e.g. nvim)
# map ctrl+tab send_text all \x1b[9;5u

# fix ctrl+v paste
# map super+v send_text all \x16
# map ctrl+v paste_from_clipboard
# map ctrl+c copy_to_clipboard

# shift+alt+HJKL for tmux pane creation
# map shift+alt+h send_text all \x1bH
# map shift+alt+j send_text all \x1bJ
# map shift+alt+k send_text all \x1bK
# map shift+alt+l send_text all \x1bL

# session management
startup_session ~/.config/kitty/sessions/dotfiles.kitty-session

# map kitty_mod+enter new_window_with_cwd
map kitty_mod+t new_tab_with_cwd
map ctrl+t new_tab_with_cwd
# map ctrl+tab previous_tab

# windows and stacking
enabled_layouts stack,fat
map ctrl+shift+z toggle_layout stack
map ctrl+shift+j previous_window
map ctrl+tab previous_window
map ctrl+shift+k next_window
# map cmd+b>space next_window

# karabiner remaps c-s-p to f7
map cmd+b>l>a goto_session ~/.config/kitty/sessions/livity-app.kitty-session
map cmd+b>l>w goto_session ~/.config/kitty/sessions/livityapp-web.kitty-session
map cmd+b>a>r goto_session ~/.config/kitty/sessions/arcane.kitty-session
map cmd+b>p>e goto_session ~/.config/kitty/sessions/peach.kitty-session
map cmd+b>i>w goto_session ~/.config/kitty/sessions/incline-web.kitty-session
map cmd+b>l>e goto_session ~/.config/kitty/sessions/lellas.kitty-session
map cmd+b>t goto_session ~/.config/kitty/sessions/tmux.kitty-session
map cmd+b>d goto_session ~/.config/kitty/sessions/dotfiles.kitty-session
map cmd+b>c goto_session ~/.config/kitty/sessions/nvim.kitty-session
map cmd+b>n goto_session ~/.config/kitty/sessions/notes.kitty-session
map cmd+b>s goto_session ~/.config/kitty/sessions/scratch.kitty-session

map cmd+b>cmd+b goto_session -1
# map cmd+b>f goto_session

# tab navigation
# map ctrl+shift+g select_tab
# map cmd+b>x close_tab
# map cmd+b>c new_tab_with_cwd
# map ctrl+shift+h previous_tab
# map ctrl+shift+l next_tab
# map cmd+k next_tab
# map cmd+j previous_tab

# Dim text in inactive windows
# inactive_text_alpha 0.2

# Optional: also dim the background
# dim_opacity 0.2

scrollback_pager nvim --cmd 'set eventignore=FileType' +'nnoremap q ZQ' +'set nomodified readonly nolist' +'luafile ~/.config/nvim/lua/config/scrollback.lua' +'TermHl' +'$' -
map cmd+b>/ show_scrollback
